// Generated by andromda-angular cartridge (app\usecase\action.store.ts.vsl) DO NOT EDIT
import { Injectable } from '@angular/core';
import { VoiceTrafficRestControllerImpl } from '@app/service/bw/org/bocra/portal/form/voice/voicetraffic-rest-controller.impl';
import { Actions, createEffect, ofType } from '@ngrx/effects';
import { catchError, map, mergeMap } from 'rxjs';
import * as VoiceTrafficActions from './voice-traffic.action';

@Injectable()
export class VoiceTrafficEffects {
  constructor(private actions$: Actions, private voiceService: VoiceTrafficRestControllerImpl) {}

  saveSim$ = createEffect(() =>
    this.actions$.pipe(
      ofType(VoiceTrafficActions.saveVoiceTraffic),
      mergeMap(({ voice }) =>
        this.voiceService.save(voice).pipe(
          map((voice) => VoiceTrafficActions.saveVoiceTrafficSuccess({ voice })),
          catchError(({ error }) => [VoiceTrafficActions.voiceTrafficActionFailure(error)])
        )
      )
    )
  );

  findById$ = createEffect(() =>
    this.actions$.pipe(
      ofType(VoiceTrafficActions.findById),
      mergeMap(({ id }) =>
        this.voiceService.findById(id).pipe(
          map((voice) => VoiceTrafficActions.findByIdSuccess({ voice })),
          catchError(({ error }) => [VoiceTrafficActions.voiceTrafficActionFailure(error)])
        )
      )
    )
  );

  loadAll$ = createEffect(() =>
    this.actions$.pipe(
      ofType(VoiceTrafficActions.loadAll),
      mergeMap(() =>
        this.voiceService.getAll().pipe(
          map((voices) => VoiceTrafficActions.loadAllSuccess({ voices })),
          catchError(({ error }) => [VoiceTrafficActions.voiceTrafficActionFailure(error)])
        )
      )
    )
  );

  searchSims$ = createEffect(() =>
    this.actions$.pipe(
        ofType(VoiceTrafficActions.searchVoiceTraffic),
        mergeMap(({searchCriteria}) => 
            this.voiceService.searchSims(searchCriteria).pipe(
                map((voices) => VoiceTrafficActions.searchVoiceTrafficSuccess({voices})),
                catchError(({ error }) => [VoiceTrafficActions.voiceTrafficActionFailure(error)])
            )
        )
    )
  );
}
