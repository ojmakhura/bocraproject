<div class="card container">
	<div class="card-body">
		<form [formGroup]="reportElementGroup">
			<div>
				<div class="mb-3 row">
					<label for="report-type" class="col-sm-2 col-form-label">Report Type</label>
					<div class="col-sm-10">
						<select id="report-type" class="form-select" (change)="reportTypeChange()"
							formControlName="reportType" aria-label="Select report type">
							<option></option>
							<option value="default">Default</option>
							<option value="custom">Custom</option>
						</select>
					</div>
				</div>
				<div *ngIf="reportType">
					<div class="mb-3" *ngIf="reportType === 'custom'">
						<div class="mb-3">

							<mat-tab-group animationDuration="0ms" class="view-tabs">
								<mat-tab label="{{ 'periods' | translate }}">
									<table class="table">
										<thead>
											<tr>
												<th scope="col">
													Select
												</th>
												<th scope="col">
													Periods
												</th>
											</tr>
										</thead>
										<tbody formArrayName="periodSelections">
											<tr *ngFor="let period of periodSelectionsArray.controls; let k=index"
												[formGroupName]="k">
												<td scope="col">
													<input type="checkbox" formControlName="selected"
														aria-label="Checkbox for following text input"
														(change)="periodSelectionChange()">
												</td>
												<td scope="col">
													{{ period.value.period }}
												</td>
											</tr>
										</tbody>
									</table>
								</mat-tab>
								<mat-tab label="{{ 'licensees' | translate }}">
									<table class="table">
										<thead>
											<tr>
												<th scope="col">
													Select
												</th>
												<th scope="col">
													Licensee
												</th>
											</tr>
										</thead>
										<tbody formArrayName="licenseeSelections">
											<tr *ngFor="let licensee of licenseeSelectionsArray.controls; let j=index"
												[formGroupName]="j">
												<td scope="col">
													<input type="checkbox" formControlName="selected"
														aria-label="Checkbox for following text input"
														(change)="licenseeSelectionChange()">
												</td>
												<td scope="col">
													{{ licensee.value.licensee }}
												</td>
											</tr>
										</tbody>
									</table>
								</mat-tab>
								<mat-tab label="{{ 'data.fields' | translate }}">
									<table class="table">
										<thead>
											<tr>
												<th scope="col">
													Select
												</th>
												<th scope="col">
													Field ID
												</th>
												<th scope="col">
													Field Name
												</th>
												<th scope="col">
													Alias
												</th>
											</tr>
										</thead>
										<tbody formArrayName="fieldSelections">
											<tr *ngFor="let fieldControl of fieldSelectionsArray.controls; let j=index"
												[formGroupName]="j">
												<td scope="col">
													<input type="checkbox" formControlName="selected"
														aria-label="Checkbox for following text input"
														(change)="fieldSelectionChange()">
												</td>
												<td scope="col">
													{{ fieldControl?.value?.fieldId }}
												</td>
												<td scope="col">
													{{ fieldControl?.value?.fieldName }}
												</td>
												<td scope="col">
													<input type="text" class="form-control" formControlName="alias" (change)="fieldSelectionChange()">
												</td>
											</tr>
										</tbody>
									</table>
								</mat-tab>
							</mat-tab-group>
						</div>
					</div>

					<div class="mb-3 row">
						<label for="report-labels" class="col-sm-2 col-form-label">Report Labels</label>
						<div class="col-sm-10">
							<select id="report-labels" class="form-select" formControlName="reportLabels"
								aria-label="Default select example">
								<option value="licensees">Licensees</option>
								<option value="periods">Periods</option>
								<option value="fields">Data Fields</option>
							</select>
						</div>
					</div>
					<div class="card mb-3">
						<table class="table" *ngIf="reportLabelsAnalyticsControl?.length > 0">
							<thead>
								<tr>
									<th></th>
									<th scope="col">
										Type
									</th>
									<th scope="col">
										Analytic Name
									</th>
									<th scope="col">
										Analytic Sources
									</th>
								</tr>
							</thead>
							<tbody formArrayName="reportLabelsAnalytics">
								<tr *ngFor="let fieldControl of reportLabelsAnalyticsControl.controls; let j=index"
										[formGroupName]="j">
									<td scope="col">
										<button type="button" (click)="removeLabelsAnalytic('report', j)"
													class="btn btn-outline-primary">
											<mat-icon>delete</mat-icon>
										</button>
									</td>
									<td scope="col">
										<div class="col-sm-10">
											<select id="report-labels" class="form-select" formControlName="type"
												aria-label="Default select example" (change)="additionalReportLabelChange(j)">
												<option value="custom">Custom</option>
												<option value="sum">Sum</option>
												<option value="mean">Mean</option>
												<option value="mode">Mode</option>
												<option value="median">Median</option>
												<option value="variance">Variance</option>
												<option value="std">Standard Deviation</option>
												<option value="min">Minimum</option>
												<option value="max">Maximum</option>
											</select>
										</div>
									</td>
									<td scope="col">
										<input type="text" class="form-control" formControlName="name" (change)="additionalReportLabelChange(j)" *ngIf="fieldControl.value?.type">
									</td>
									<td scope="col">
										<textarea type="text" class="form-control" formControlName="sources" (change)="additionalReportLabelChange(j)" *ngIf="fieldControl.value?.name"></textarea>
									</td>
								</tr>
							</tbody>
						</table>
						<div class="mb-3" >
							<button type="button"  class="btn btn-primary" (click)="addLabelsAnalytic('report')">Add</button>
						</div>
					</div>
					<div class="mb-3 row" *ngIf="reportLabels !== null">
						<label for="data-labels" class="col-sm-2 col-form-label">Data Labels</label>
						<div class="col-sm-10">
							<select id="data-labels" class="form-select" formControlName="dataLabels"
								aria-label="Default select example" (change)="generateColors(true)">
								<option></option>
								<option value="licensees" *ngIf="reportLabels !== 'licensees'">Licensees</option>
								<option value="periods">Periods</option>
								<option value="fields">DataFields</option>
							</select>
						</div>
					</div>
				</div>

				<div class="card mb-3" *ngIf="false">
					<table class="table" *ngIf="dataLabelsAnalyticsControl?.length > 0">
						<thead>
							<tr>
								<th></th>
								<th scope="col">
									Type
								</th>
								<th scope="col">
									Analytic Name
								</th>
							</tr>
						</thead>
						<tbody formArrayName="dataLabelsAnalytics">
							<tr *ngFor="let fieldControl of dataLabelsAnalyticsControl.controls; let j=index"
								[formGroupName]="j">
								<td scope="col">
									<button type="button" (click)="removeLabelsAnalytic('data', j)"
                                                class="btn btn-outline-primary">
                                        <mat-icon>delete</mat-icon>
                                    </button>
								</td>
								<td scope="col">
									<div class="col-sm-10">
										<select id="report-labels" class="form-select" formControlName="type"
											aria-label="Default select example" (change)="additionalDataLabelChange()">
											<option value="sum">Sum</option>
											<option value="mean">Mean</option>
											<option value="mode">Mode</option>
											<option value="median">Median</option>
											<option value="variance">Variance</option>
											<option value="std">Standard Deviation</option>
										</select>
									</div>
								</td>
								<td scope="col">
									<input type="text" class="form-control" formControlName="name" (change)="additionalDataLabelChange()">
								</td>
							</tr>
						</tbody>
					</table>
					<div class="mb-3" >
						<button type="button"  class="btn btn-primary" (click)="addLabelsAnalytic('data')">Add</button>
					</div>
				</div>
				<div class="mb-3" *ngIf="this.chartsControl?.length > 0">
					<button type="button" class="btn btn-primary" (click)="refreshColors()">
						Colors
					</button>
				</div>
				<!-- <div>
					<span>{{selectedLabels}}</span>
				</div>
				<div>
					<span>{{dataLabels}}</span>
				</div>
				<div>
					<span>{{selectedDataLabels}}</span>
				</div> -->
				<div *ngFor="let chartControl of chartsControl?.controls; let i=index">
					<app-report-chart 
						[labelSource]="reportLabels"
						[dataLabels]="dataLabels"
						[reportType]="reportType"
						[colors]="colors"
						[reportChartGroup]="chartControl" 
						[formSubmissions]="filteredFormSubmissions"
						[selectedLicensees]="selectedLicensees"
						[selectedFields]="selectedFields"
						[selectedPeriods]="selectedPeriods"
						[additionalReportLabels]="additionalReportLabels"
						[additionalDataLabels]="additionalDataLabels"
						[customReportLabels]="customReportLabels"
						[chartIndex]="i">
					</app-report-chart>
					<div class="mb-3">
						<button type="button" class="btn btn-info" (click)="removeReportChart(i)">
							<mat-icon>delete</mat-icon>
						</button>
					</div>
	
				</div>
				<div class="mb-3">
					<button type="button" class="btn bi bi-plus-circle" (click)="addReportChart()"></button>
				</div>
			</div>
		</form>
	</div>
</div>