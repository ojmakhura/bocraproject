<div class="card container">
	<div class="card-body">
		<form [formGroup]="reportForm">
			<section>
				<div class="col my-3 view-buttons">
					<button type="button" color="accent" (click)="reportSearch()" class="btn btn-info">
						<span translate>search</span>
					</button>
				</div>
			</section>
			<div formArrayName="formReports" class="container">
				<div class="card-body" *ngFor="let formReportControl of formReportsControl.controls; let i=index"
					[formGroupName]="i">
					<div class="row mb-3">
						<h4>{{getFormReport(i)?.formName}} Report</h4>
					</div>
					<div class="row mb-3">
						<label id="submission_num-{{i}}-label" class="col-sm-2 col-form-label">Number of Submissions:
						</label>
						<label id="submission_num-{{i}}-label"
							class="col-sm-2 col-form-label">{{getFormReport(i)?.submissions?.length}}</label>
					</div>
					<div class="row mb-3">
					</div>

					<div formArrayName="reportElements">
						<div *ngFor="let element of getReportElementsControl(i)?.controls; let j=index"
							[formGroupName]="j">
							<div class="mb-3">

								<div class="mb-3">
									<label for="chart-type-{{i}}-{{j}}">Chart Type</label>
									<select id="chart-type-{{i}}-{{j}}" class="form-select" formControlName="chartType"
										aria-label="Default select example" (change)="selectedChartType(i, j)">
										<option value="bar">Bar</option>
										<!-- <option value="bubble">Bubble</option> -->
										<!-- <option value="doughnut">Doughnut</option> -->
										<!-- <option value="line">Line</option> -->
										<option value="pie">Pie</option>
										<option value="table">Table</option>
										<!-- <option value="polarArea">Polar Area</option> -->
										<!-- <option value="radar">Radar</option> -->
										<!-- <option value="scatter">Scatter</option> -->
									</select>
								</div>
								<div class="mb-3">
									<label for="report-type-{{i}}-{{j}}">Report Type</label>
									<select id="report-type-{{i}}-{{j}}" class="form-select"
										formControlName="reportType" aria-label="Select report type">
										<option selected value="default">Default</option>
										<option value="custom">Custom</option>
									</select>
								</div>
								<div class="mb-3" *ngIf="element.value?.reportType === 'custom'">
									<div class="mb-3">
										<label for="report-labels-{{i}}-{{j}}">Report Labels</label>
										<select id="report-labels-{{i}}-{{j}}" class="form-select"
											formControlName="reportLabels" aria-label="Default select example"
											(change)="getLabels(i, element)">
											<option selected value="licensees">Licensees</option>
											<option value="periods">Periods</option>
										</select>
									</div>
								</div>
								<div class="col mb-3">
									<button type="button" class="btn btn-primary" (click)="generateReport(i, j)">
										Generate
									</button>
									<button type="button" class="btn btn-primary" (click)="clearReport(i, j)">
										Clear
									</button>
								</div>
								<div class="col mb-3" formArrayName="sectionGraphs">
									<div *ngFor="let sectionGraph of getSectionGraphsControls(i, j)?.controls; let k=index"
										[formGroupName]="k">
										<div class="mb-3">
											<h5>Section: {{sectionGraph?.value?.section}}</h5>
										</div>
										<div *ngIf="element?.value?.chartType === 'bar'">
											<canvas #chart baseChart [datasets]="sectionGraph?.value?.licenseeGraphData"
												[labels]="sectionGraph?.value?.fieldList"
												[type]="element?.value?.chartType">
											</canvas>
										</div>
										<div *ngIf="element?.value?.chartType === 'pie'">
											<div *ngFor="let graph of sectionGraph?.value?.fieldGraphs; let l=index">
												<h6>{{sectionGraph?.value?.fieldList[l]}}</h6>
												<canvas baseChart [datasets]="[{data: graph}]"
													[labels]="formReportControl?.value?.licensees"
													[type]="element?.value?.chartType">
												</canvas>
											</div>
										</div>
										<div *ngIf="element?.value?.chartType === 'table'">
											<table class="table table-striped">
												<thead>
													<tr>
														<th scope="col">Field</th>
														<th scope="col" *ngFor="let licensee of formReportControl?.value?.licensees; let m=index">{{licensee}}</th>
													</tr>
												</thead>
												<tbody>
													<tr *ngFor="let field of sectionGraph?.value?.fieldList; let m=index">
														<th scope="row">{{field}}</th>
														<td *ngFor="let val of sectionGraph?.value?.fieldGraphs[m]">{{val}}</td>
													</tr>
												</tbody>
											</table>
										</div>
									</div>
								</div>
								<div class="col">
									<button type="button" class="btn btn-primary" (click)="removeReportElement(i, j)">
										<mat-icon>delete</mat-icon>
									</button>
								</div>
							</div>
						</div>
						<div>
							<button type="button" class="btn bi bi-plus-circle" (click)="addReportElement(i)"></button>
						</div>
					</div>
				</div>
			</div>
		</form>
	</div>
</div>